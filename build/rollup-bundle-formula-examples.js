function e(t){return(e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(t)}function t(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=[],r=!0,o=!1,s=void 0;try{for(var i,a=e[Symbol.iterator]();!(r=(i=a.next()).done)&&(n.push(i.value),!t||n.length!==t);r=!0);}catch(e){o=!0,s=e}finally{try{r||null==a.return||a.return()}finally{if(o)throw s}}return n}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance")}()}function r(e){return function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}(e)||function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}()}function o(){}function s(e){return e()}function i(){return Object.create(null)}function a(e){e.forEach(s)}function l(e){return"function"==typeof e}function u(e,t){return e!=e?t==t:e!==t||e&&"object"==typeof e||"function"==typeof e}function c(e,t){e.appendChild(t)}function f(e,t,n){e.insertBefore(t,n||null)}function p(e){e.parentNode.removeChild(e)}function m(e,t){for(let n=0;n<e.length;n+=1)e[n]&&e[n].d(t)}function h(e){return document.createElement(e)}function d(e){return document.createTextNode(e)}function g(){return d(" ")}function y(e,t,n,r){return e.addEventListener(t,n,r),()=>e.removeEventListener(t,n,r)}function b(e,t,n){null==n?e.removeAttribute(t):e.setAttribute(t,n)}function v(e,t){t=""+t,e.data!==t&&(e.data=t)}let C;function $(e){C=e}function x(){const e=C;return(t,n)=>{const r=e.$$.callbacks[t];if(r){const o=function(e,t){const n=document.createEvent("CustomEvent");return n.initCustomEvent(e,!1,!1,t),n}(t,n);r.slice().forEach(t=>{t.call(e,o)})}}}const w=[],S=[],E=[],A=[],N=Promise.resolve();let R=!1;function D(e){E.push(e)}function F(){const e=new Set;do{for(;w.length;){const e=w.shift();$(e),T(e.$$)}for(;S.length;)S.pop()();for(let t=0;t<E.length;t+=1){const n=E[t];e.has(n)||(n(),e.add(n))}E.length=0}while(w.length);for(;A.length;)A.pop()();R=!1}function T(e){e.fragment&&(e.update(e.dirty),a(e.before_update),e.fragment.p(e.dirty,e.ctx),e.dirty=null,e.after_update.forEach(D))}const I=new Set;let B;function O(e,t){e&&e.i&&(I.delete(e),e.i(t))}function M(e,t){e.d(1),t.delete(e.key)}function j(e,t,n){const{fragment:r,on_mount:o,on_destroy:i,after_update:u}=e.$$;r.m(t,n),D(()=>{const t=o.map(s).filter(l);i?i.push(...t):a(t),e.$$.on_mount=[]}),u.forEach(D)}function P(e,t){e.$$.fragment&&(a(e.$$.on_destroy),e.$$.fragment.d(t),e.$$.on_destroy=e.$$.fragment=null,e.$$.ctx={})}function _(e,t){e.$$.dirty||(w.push(e),R||(R=!0,N.then(F)),e.$$.dirty=i()),e.$$.dirty[t]=!0}function U(e,t,n,r,s,l){const u=C;$(e);const c=t.props||{},f=e.$$={fragment:null,ctx:null,props:l,update:o,not_equal:s,bound:i(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(u?u.$$.context:[]),callbacks:i(),dirty:null};let p=!1;f.ctx=n?n(e,c,(t,n)=>{f.ctx&&s(f.ctx[t],f.ctx[t]=n)&&(f.bound[t]&&f.bound[t](n),p&&_(e,t))}):c,f.update(),p=!0,a(f.before_update),f.fragment=r(f.ctx),t.target&&(t.hydrate?f.fragment.l(function(e){return Array.from(e.childNodes)}(t.target)):f.fragment.c(),t.intro&&O(e.$$.fragment),j(e,t.target,t.anchor),F()),$(u)}class k{$destroy(){P(this,1),this.$destroy=o}$on(e,t){const n=this.$$.callbacks[e]||(this.$$.callbacks[e]=[]);return n.push(t),()=>{const e=n.indexOf(t);-1!==e&&n.splice(e,1)}}$set(){}}function L(e,t){return e<t?-1:e>t?1:e>=t?0:NaN}var H,z;1===(H=L).length&&(z=H,H=function(e,t){return L(z(e),t)});function V(e,t){let n=0;if(void 0===t)for(let t of e)(t=+t)&&(n+=t);else{let r=-1;for(let o of e)(o=+t(o,++r,e))&&(n+=o)}return n}function q(e,t,n){const r=Object.create(e);return r.l=t[n],r}function G(e,t,n){const r=Object.create(e);return r.t=t[n],r}function W(e){for(var t,n,r,o,s,i,a,l,u,y,C,$,x,w,S,E=e.planDeCompte.Exer,A=e.lignes.length,N=[],R=new Map,D=["RD","FI","Fonction","Nature","Montant"],F=[],T=0;T<5;T+=1)F[T]=J(G(e,D,T));var I=e.lignes;const B=e=>e.l;for(T=0;T<I.length;T+=1){let t=q(e,I,T),n=B(t);R.set(n,N[T]=Z(n,t))}return{c(){t=h("h1"),n=d("Compte Administratif Gironde "),r=d(E),o=g(),s=h("h2"),i=d(A),a=d(" lignes | "),l=d(e.total),u=g(),y=h("output"),C=h("table"),$=h("thead"),x=h("tr");for(var c=0;c<5;c+=1)F[c].c();for(w=g(),S=h("tbody"),c=0;c<N.length;c+=1)N[c].c();b(y,"class","svelte-1tdag8o")},m(e,p){f(e,t,p),c(t,n),c(t,r),f(e,o,p),f(e,s,p),c(s,i),c(s,a),c(s,l),f(e,u,p),f(e,y,p),c(y,C),c(C,$),c($,x);for(var m=0;m<5;m+=1)F[m].m(x,null);for(c(C,w),c(C,S),m=0;m<N.length;m+=1)N[m].m(S,null)},p(e,t){e.planDeCompte&&E!==(E=t.planDeCompte.Exer)&&v(r,E),e.lignes&&A!==(A=t.lignes.length)&&v(i,A),e.total&&v(l,t.total);const n=t.lignes;N=function(e,t,n,r,o,s,i,a,l,u,c,f){let p=e.length,m=s.length,h=p;const d={};for(;h--;)d[e[h].key]=h;const g=[],y=new Map,b=new Map;for(h=m;h--;){const e=f(o,s,h),a=n(e);let l=i.get(a);l?r&&l.p(t,e):(l=u(a,e)).c(),y.set(a,g[h]=l),a in d&&b.set(a,Math.abs(h-d[a]))}const v=new Set,C=new Set;function $(e){O(e,1),e.m(a,c),i.set(e.key,e),c=e.first,m--}for(;p&&m;){const t=g[m-1],n=e[p-1],r=t.key,o=n.key;t===n?(c=t.first,p--,m--):y.has(o)?!i.has(r)||v.has(r)?$(t):C.has(o)?p--:b.get(r)>b.get(o)?(C.add(r),$(t)):(v.add(o),p--):(l(n,i),p--)}for(;p--;){const t=e[p];y.has(t.key)||l(t,i)}for(;m;)$(g[m-1]);return g}(N,e,B,1,t,n,R,S,M,Z,null,q)},d(e){for(e&&(p(t),p(o),p(s),p(u),p(y)),m(F,e),T=0;T<N.length;T+=1)N[T].d()}}}function J(e){var t,n;return{c(){t=h("th"),n=d(e.t)},m(e,r){f(e,t,r),c(t,n)},p:o,d(e){e&&p(t)}}}function Z(e,t){var n,r,o,s,i,a,l,u,m,y,C,$,x,w,S,E,A=t.l.CodRD,N=t.planDeCompte.ligneBudgetFI(t.l),R=t.l.Fonction,D=t.l.Nature,F=t.l.MtReal.toLocaleString("fr-FR",{style:"currency",currency:"EUR"});return{key:e,first:null,c(){n=h("tr"),r=h("td"),o=d(A),s=g(),i=h("td"),a=d(N),l=g(),u=h("td"),m=d(R),y=g(),C=h("td"),$=d(D),x=g(),w=h("td"),S=d(F),E=g(),b(r,"class","svelte-1tdag8o"),b(i,"class","svelte-1tdag8o"),b(u,"class","svelte-1tdag8o"),b(C,"class","svelte-1tdag8o"),b(w,"class","svelte-1tdag8o"),this.first=n},m(e,t){f(e,n,t),c(n,r),c(r,o),c(n,s),c(n,i),c(i,a),c(n,l),c(n,u),c(u,m),c(n,y),c(n,C),c(C,$),c(n,x),c(n,w),c(w,S),c(n,E)},p(e,t){e.lignes&&A!==(A=t.l.CodRD)&&v(o,A),(e.planDeCompte||e.lignes)&&N!==(N=t.planDeCompte.ligneBudgetFI(t.l))&&v(a,N),e.lignes&&R!==(R=t.l.Fonction)&&v(m,R),e.lignes&&D!==(D=t.l.Nature)&&v($,D),e.lignes&&F!==(F=t.l.MtReal.toLocaleString("fr-FR",{style:"currency",currency:"EUR"}))&&v(S,F)},d(e){e&&p(n)}}}function Y(e){var t,n=e.planDeCompte&&e.lignes&&W(e);return{c(){n&&n.c(),t=d("")},m(e,r){n&&n.m(e,r),f(e,t,r)},p(e,r){r.planDeCompte&&r.lignes?n?n.p(e,r):((n=W(r)).c(),n.m(t.parentNode,t)):n&&(n.d(1),n=null)},i:o,o:o,d(e){n&&n.d(e),e&&p(t)}}}function K(e,t,n){let r,{lignes:o,planDeCompte:s}=t;return e.$set=e=>{"lignes"in e&&n("lignes",o=e.lignes),"planDeCompte"in e&&n("planDeCompte",s=e.planDeCompte)},e.$$.update=(e={lignes:1})=>{e.lignes&&n("total",r=o&&V(o.map(e=>e.MtReal)).toLocaleString("fr-FR",{style:"currency",currency:"EUR"}))},{lignes:o,planDeCompte:s,total:r}}class Q extends k{constructor(e){super(),U(this,e,K,Y,u,["lignes","planDeCompte"])}}function X(e,t,n){const r=Object.create(e);return r.formula=t[n].formula,r.description=t[n].description,r}function ee(e){var t,n,r,o,s,i,a,l,u,m,y=e.formula,C=e.description;return{c(){t=h("li"),n=h("a"),r=h("code"),o=d(y),i=g(),a=h("span"),l=d(": "),u=d(C),m=g(),b(n,"href",s="#"+encodeURIComponent(e.formula))},m(e,s){f(e,t,s),c(t,n),c(n,r),c(r,o),c(t,i),c(t,a),c(a,l),c(a,u),c(t,m)},p(e,t){e.examples&&y!==(y=t.formula)&&v(o,y),e.examples&&s!==(s="#"+encodeURIComponent(t.formula))&&b(n,"href",s),e.examples&&C!==(C=t.description)&&v(u,C)},d(e){e&&p(t)}}}function te(e){for(var t,n,r,o,s,i,l,u,c,d,v,C,$,x,w=e.examples,S=[],E=0;E<w.length;E+=1)S[E]=ee(X(e,w,E));var A=new Q({props:{lignes:e.lignes,planDeCompte:e.planDeCompte}});return{c(){(t=h("h1")).textContent="Outil de test de formules",n=g(),(r=h("h2")).textContent="Un outil pour filtrer les lignes d'un document budgétaires",o=g(),(s=h("p")).innerHTML='Pour le moment, cet outil ne filtre que les données des <a href="https://www.datalocale.fr/dataset/comptes-administratifs-budget-principal-donnees-budgetaires-du-departement-de-la-gironde">Comptes Administratifs du Département de la Gironde</a> pour l\'année 2017',i=g(),(l=h("h2")).textContent="Exemples de formules",u=g(),c=h("ul");for(var a=0;a<S.length;a+=1)S[a].c();d=g(),v=h("input"),C=g(),A.$$.fragment.c(),b(c,"class","examples"),v.autofocus=!0,b(v,"class","formula svelte-4pus9p"),b(v,"type","text"),x=[y(v,"input",e.input_input_handler),y(v,"input",e.input_handler)]},m(a,p){f(a,t,p),f(a,n,p),f(a,r,p),f(a,o,p),f(a,s,p),f(a,i,p),f(a,l,p),f(a,u,p),f(a,c,p);for(var m=0;m<S.length;m+=1)S[m].m(c,null);f(a,d,p),f(a,v,p),v.value=e.formula,f(a,C,p),j(A,a,p),$=!0,v.focus()},p(e,t){if(e.examples){w=t.examples;for(var n=0;n<w.length;n+=1){const r=X(t,w,n);S[n]?S[n].p(e,r):(S[n]=ee(r),S[n].c(),S[n].m(c,null))}for(;n<S.length;n+=1)S[n].d(1);S.length=w.length}e.formula&&v.value!==t.formula&&(v.value=t.formula);var r={};e.lignes&&(r.lignes=t.lignes),e.planDeCompte&&(r.planDeCompte=t.planDeCompte),A.$set(r)},i(e){$||(O(A.$$.fragment,e),$=!0)},o(e){!function(e,t,n){if(e&&e.o){if(I.has(e))return;I.add(e),B.callbacks.push(()=>{I.delete(e),n&&(e.d(1),n())}),e.o(t)}}(A.$$.fragment,e),$=!1},d(e){e&&(p(t),p(n),p(r),p(o),p(s),p(i),p(l),p(u),p(c)),m(S,e),e&&(p(d),p(v),p(C)),P(A,e),a(x)}}}function ne(e,t,n){const r=x();let{formula:o,planDeCompte:s,lignes:i,examples:a}=t;return e.$set=e=>{"formula"in e&&n("formula",o=e.formula),"planDeCompte"in e&&n("planDeCompte",s=e.planDeCompte),"lignes"in e&&n("lignes",i=e.lignes),"examples"in e&&n("examples",a=e.examples)},{dispatch:r,formula:o,planDeCompte:s,lignes:i,examples:a,input_input_handler:function(){o=this.value,n("formula",o)},input_handler:function(e){return r("formula-change",e.target.value.trim())}}}class re extends k{constructor(e){super(),U(this,e,ne,te,u,["formula","planDeCompte","lignes","examples"])}}function oe(e,t,n,r){var o,s=null==(o=r)||"number"==typeof o||"boolean"==typeof o?r:n(r),i=t.get(s);return void 0===i&&(i=e.call(this,r),t.set(s,i)),i}function se(e,t,n){var r=Array.prototype.slice.call(arguments,3),o=n(r),s=t.get(o);return void 0===s&&(s=e.apply(this,r),t.set(o,s)),s}function ie(e,t,n,r,o){return n.bind(t,e,r,o)}function ae(e,t){return ie(e,this,1===e.length?oe:se,t.cache.create(),t.serializer)}function le(){return JSON.stringify(arguments)}function ue(){this.cache=Object.create(null)}ue.prototype.has=function(e){return e in this.cache},ue.prototype.get=function(e){return this.cache[e]},ue.prototype.set=function(e,t){this.cache[e]=t};var ce={create:function(){return new ue}},fe=function(e,t){var n=t&&t.cache?t.cache:ce,r=t&&t.serializer?t.serializer:le;return(t&&t.strategy?t.strategy:ae)(e,{cache:n,serializer:r})},pe={variadic:function(e,t){return ie(e,this,se,t.cache.create(),t.serializer)},monadic:function(e,t){return ie(e,this,oe,t.cache.create(),t.serializer)}};function me(){var t=new WeakMap,n=1;return function(){for(var r=arguments.length,o=new Array(r),s=0;s<r;s++)o[s]=arguments[s];return o.map(function(r){if(null==r||"boolean"==typeof r)return String(r);switch(e(r)){case"number":case"string":return"".concat(e(r),"(").concat(r,")");case"object":case"symbol":var o=t.get(r);return void 0===o&&(o=n,t.set(r,o),n++),o.toString(36);default:return console.error("Unhandled type",e(r)),"Ser"+Math.random().toString(36).slice(2)}}).join(" ")}}function he(e,t,n,r){var o,s=null==(o=r)||"number"==typeof o||"boolean"==typeof o?r:n(r),i=t.get(s);return void 0===i&&(i=e.call(this,r),t.set(s,i)),i}function de(e,t,n){for(var r=arguments.length,o=new Array(r>3?r-3:0),s=3;s<r;s++)o[s-3]=arguments[s];var i=n.apply(void 0,o),a=t.get(i);return void 0===a&&(a=e.apply(this,o),t.set(i,a)),a}function ge(e){return fe(e,{serializer:new me,strategy:function(e,t){return function(e,t,n,r,o){return n.bind(t,e,r,o)}(e,this,1===e.length?he:de,t.cache.create(),t.serializer)}})}fe.strategies=pe;var ye={},be={},ve=34,Ce=10,$e=13;function xe(e){return new Function("d","return {"+e.map(function(e,t){return JSON.stringify(e)+": d["+t+"]"}).join(",")+"}")}function we(e){var t=Object.create(null),n=[];return e.forEach(function(e){for(var r in e)r in t||n.push(t[r]=r)}),n}function Se(e,t){var n=e+"",r=n.length;return r<t?new Array(t-r+1).join(0)+n:n}function Ee(e){var t,n=e.getUTCHours(),r=e.getUTCMinutes(),o=e.getUTCSeconds(),s=e.getUTCMilliseconds();return isNaN(e)?"Invalid Date":((t=e.getUTCFullYear())<0?"-"+Se(-t,6):t>9999?"+"+Se(t,6):Se(t,4))+"-"+Se(e.getUTCMonth()+1,2)+"-"+Se(e.getUTCDate(),2)+(s?"T"+Se(n,2)+":"+Se(r,2)+":"+Se(o,2)+"."+Se(s,3)+"Z":o?"T"+Se(n,2)+":"+Se(r,2)+":"+Se(o,2)+"Z":r||n?"T"+Se(n,2)+":"+Se(r,2)+"Z":"")}function Ae(e){var t=new RegExp('["'+e+"\n\r]"),n=e.charCodeAt(0);function r(e,t){var r,o=[],s=e.length,i=0,a=0,l=s<=0,u=!1;function c(){if(l)return be;if(u)return u=!1,ye;var t,r,o=i;if(e.charCodeAt(o)===ve){for(;i++<s&&e.charCodeAt(i)!==ve||e.charCodeAt(++i)===ve;);return(t=i)>=s?l=!0:(r=e.charCodeAt(i++))===Ce?u=!0:r===$e&&(u=!0,e.charCodeAt(i)===Ce&&++i),e.slice(o+1,t-1).replace(/""/g,'"')}for(;i<s;){if((r=e.charCodeAt(t=i++))===Ce)u=!0;else if(r===$e)u=!0,e.charCodeAt(i)===Ce&&++i;else if(r!==n)continue;return e.slice(o,t)}return l=!0,e.slice(o,s)}for(e.charCodeAt(s-1)===Ce&&--s,e.charCodeAt(s-1)===$e&&--s;(r=c())!==be;){for(var f=[];r!==ye&&r!==be;)f.push(r),r=c();t&&null==(f=t(f,a++))||o.push(f)}return o}function o(t,n){return t.map(function(t){return n.map(function(e){return i(t[e])}).join(e)})}function s(t){return t.map(i).join(e)}function i(e){return null==e?"":e instanceof Date?Ee(e):t.test(e+="")?'"'+e.replace(/"/g,'""')+'"':e}return{parse:function(e,t){var n,o,s=r(e,function(e,r){if(n)return n(e,r-1);o=e,n=t?function(e,t){var n=xe(e);return function(r,o){return t(n(r),o,e)}}(e,t):xe(e)});return s.columns=o||[],s},parseRows:r,format:function(t,n){return null==n&&(n=we(t)),[n.map(i).join(e)].concat(o(t,n)).join("\n")},formatBody:function(e,t){return null==t&&(t=we(e)),o(e,t).join("\n")},formatRows:function(e){return e.map(s).join("\n")}}}var Ne=Ae(","),Re=(Ne.parse,Ne.parseRows,Ne.format,Ne.formatBody,Ne.formatRows,Ae("\t"));Re.parse,Re.parseRows,Re.format,Re.formatBody,Re.formatRows;function De(e){if(!e.ok)throw new Error(e.status+" "+e.statusText);return e.text()}var Fe,Te=(Fe="application/xml",function(e,t){return function(e,t){return fetch(e,t).then(De)}(e,t).then(function(e){return(new DOMParser).parseFromString(e,Fe)})});var Ie="undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};function Be(e,t){return e(t={exports:{}},t.exports),t.exports}var Oe=Be(function(e){var t,n;t=Ie,n=function(){function e(t,n,r){return this.id=++e.highestId,this.name=t,this.symbols=n,this.postprocess=r,this}function t(e,t,n,r){this.rule=e,this.dot=t,this.reference=n,this.data=[],this.wantedBy=r,this.isComplete=this.dot===e.symbols.length}function n(e,t){this.grammar=e,this.index=t,this.states=[],this.wants={},this.scannable=[],this.completed={}}function r(e,t){this.rules=e,this.start=t||this.rules[0].name;var n=this.byName={};this.rules.forEach(function(e){n.hasOwnProperty(e.name)||(n[e.name]=[]),n[e.name].push(e)})}function o(){this.reset("")}function s(e,t,s){if(e instanceof r){var i=e;s=t}else i=r.fromCompiled(e,t);for(var a in this.grammar=i,this.options={keepHistory:!1,lexer:i.lexer||new o},s||{})this.options[a]=s[a];this.lexer=this.options.lexer,this.lexerState=void 0;var l=new n(i,0);this.table=[l];l.wants[i.start]=[],l.predict(i.start),l.process(),this.current=0}return e.highestId=0,e.prototype.toString=function(e){function t(e){return e.literal?JSON.stringify(e.literal):e.type?"%"+e.type:e.toString()}var n=void 0===e?this.symbols.map(t).join(" "):this.symbols.slice(0,e).map(t).join(" ")+" ● "+this.symbols.slice(e).map(t).join(" ");return this.name+" → "+n},t.prototype.toString=function(){return"{"+this.rule.toString(this.dot)+"}, from: "+(this.reference||0)},t.prototype.nextState=function(e){var n=new t(this.rule,this.dot+1,this.reference,this.wantedBy);return n.left=this,n.right=e,n.isComplete&&(n.data=n.build()),n},t.prototype.build=function(){var e=[],t=this;do{e.push(t.right.data),t=t.left}while(t.left);return e.reverse(),e},t.prototype.finish=function(){this.rule.postprocess&&(this.data=this.rule.postprocess(this.data,this.reference,s.fail))},n.prototype.process=function(e){for(var t=this.states,n=this.wants,r=this.completed,o=0;o<t.length;o++){var i=t[o];if(i.isComplete){if(i.finish(),i.data!==s.fail){for(var a=i.wantedBy,l=a.length;l--;){var u=a[l];this.complete(u,i)}if(i.reference===this.index){var c=i.rule.name;(this.completed[c]=this.completed[c]||[]).push(i)}}}else{if("string"!=typeof(c=i.rule.symbols[i.dot])){this.scannable.push(i);continue}if(n[c]){if(n[c].push(i),r.hasOwnProperty(c)){var f=r[c];for(l=0;l<f.length;l++){var p=f[l];this.complete(i,p)}}}else n[c]=[i],this.predict(c)}}},n.prototype.predict=function(e){for(var n=this.grammar.byName[e]||[],r=0;r<n.length;r++){var o=n[r],s=this.wants[e],i=new t(o,0,this.index,s);this.states.push(i)}},n.prototype.complete=function(e,t){var n=e.nextState(t);this.states.push(n)},r.fromCompiled=function(t,n){var o=t.Lexer;t.ParserStart&&(n=t.ParserStart,t=t.ParserRules);var s=new r(t=t.map(function(t){return new e(t.name,t.symbols,t.postprocess)}),n);return s.lexer=o,s},o.prototype.reset=function(e,t){this.buffer=e,this.index=0,this.line=t?t.line:1,this.lastLineBreak=t?-t.col:0},o.prototype.next=function(){if(this.index<this.buffer.length){var e=this.buffer[this.index++];return"\n"===e&&(this.line+=1,this.lastLineBreak=this.index),{value:e}}},o.prototype.save=function(){return{line:this.line,col:this.index-this.lastLineBreak}},o.prototype.formatError=function(e,t){var n=this.buffer;if("string"==typeof n){var r=n.indexOf("\n",this.index);-1===r&&(r=n.length);var o=n.substring(this.lastLineBreak,r),s=this.index-this.lastLineBreak;return t+=" at line "+this.line+" col "+s+":\n\n",t+="  "+o+"\n",t+="  "+Array(s).join(" ")+"^"}return t+" at index "+(this.index-1)},s.fail={},s.prototype.feed=function(e){var t,r=this.lexer;for(r.reset(e,this.lexerState);t=r.next();){var s=this.table[this.current];this.options.keepHistory||delete this.table[this.current-1];var i=this.current+1,a=new n(this.grammar,i);this.table.push(a);for(var l=void 0!==t.text?t.text:t.value,u=r.constructor===o?t.value:t,c=s.scannable,f=c.length;f--;){var p=c[f],m=p.rule.symbols[p.dot];if(m.test?m.test(u):m.type?m.type===t.type:m.literal===l){var h=p.nextState({data:u,token:t,isToken:!0,reference:i-1});a.states.push(h)}}if(a.process(),0===a.states.length){var d=this.lexer.formatError(t,"invalid syntax")+"\n";d+="Unexpected "+(t.type?t.type+" token: ":""),d+=JSON.stringify(void 0!==t.value?t.value:t)+"\n";var g=new Error(d);throw g.offset=this.current,g.token=t,g}this.options.keepHistory&&(s.lexerState=r.save()),this.current++}return s&&(this.lexerState=r.save()),this.results=this.finish(),this},s.prototype.save=function(){var e=this.table[this.current];return e.lexerState=this.lexerState,e},s.prototype.restore=function(e){var t=e.index;this.current=t,this.table[t]=e,this.table.splice(t+1),this.lexerState=e.lexerState,this.results=this.finish()},s.prototype.rewind=function(e){if(!this.options.keepHistory)throw new Error("set option `keepHistory` to enable rewinding");this.restore(this.table[e])},s.prototype.finish=function(){var e=[],t=this.grammar.start;return this.table[this.table.length-1].states.forEach(function(n){n.rule.name===t&&n.dot===n.rule.symbols.length&&0===n.reference&&n.data!==s.fail&&e.push(n)}),e.map(function(e){return e.data})},{Parser:s,Grammar:r,Rule:e}},e.exports?e.exports=n():t.nearley=n()}),Me=Be(function(e){!function(){function t(e){return e[0]}var n={Lexer:void 0,ParserRules:[{name:"main",symbols:["_","AS","_"],postprocess:function(e){return e[1]}},{name:"P",symbols:[{literal:"("},"_","AS","_",{literal:")"}],postprocess:function(e){return e.filter(function(e){return!!e})}},{name:"P",symbols:["SUBSET"],postprocess:t},{name:"M",symbols:["M","_",{literal:"∩"},"_","P"],postprocess:function(e){return e.filter(function(e){return!!e})}},{name:"M",symbols:["P"],postprocess:t},{name:"AS",symbols:["AS","_",{literal:"+"},"_","M"],postprocess:function(e){return e.filter(function(e){return!!e})}},{name:"AS",symbols:["AS","_",{literal:"∪"},"_","M"],postprocess:function(e){return e.filter(function(e){return!!e})}},{name:"AS",symbols:["AS","_",{literal:"-"},"_","M"],postprocess:function(e){return e.filter(function(e){return!!e})}},{name:"AS",symbols:["M"],postprocess:t},{name:"SUBSET",symbols:["RD"],postprocess:t},{name:"SUBSET",symbols:["FI"],postprocess:t},{name:"SUBSET",symbols:["RDFI"],postprocess:t},{name:"SUBSET",symbols:["CHAPITRE"],postprocess:t},{name:"SUBSET",symbols:["COMPTE"],postprocess:t},{name:"SUBSET",symbols:["FONCTION"],postprocess:t},{name:"SUBSET",symbols:["ANNEE"],postprocess:t},{name:"RD",symbols:[{literal:"R"}],postprocess:t},{name:"RD",symbols:[{literal:"D"}],postprocess:t},{name:"FI",symbols:[{literal:"F"}],postprocess:t},{name:"FI",symbols:[{literal:"I"}],postprocess:t},{name:"RDFI",symbols:["RD","FI"],postprocess:function(e){return e.join("")}},{name:"CHAPITRE$string$1",symbols:[{literal:"C"},{literal:"h"}],postprocess:function(e){return e.join("")}},{name:"CHAPITRE$ebnf$1",symbols:[/[0-9]/]},{name:"CHAPITRE$ebnf$1",symbols:["CHAPITRE$ebnf$1",/[0-9]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"CHAPITRE",symbols:["CHAPITRE$string$1","CHAPITRE$ebnf$1"],postprocess:function(e){return e[0]+e[1].join("")}},{name:"COMPTE$ebnf$1",symbols:[/[0-9]/]},{name:"COMPTE$ebnf$1",symbols:["COMPTE$ebnf$1",/[0-9]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"COMPTE",symbols:[{literal:"C"},"COMPTE$ebnf$1"],postprocess:function(e){return e[0]+e[1].join("")}},{name:"FONCTION$ebnf$1",symbols:[/[0-9]/]},{name:"FONCTION$ebnf$1",symbols:["FONCTION$ebnf$1",/[0-9]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"FONCTION",symbols:[{literal:"F"},"FONCTION$ebnf$1"],postprocess:function(e){return e[0]+e[1].join("")}},{name:"ANNEE$string$1",symbols:[{literal:"A"},{literal:"n"},{literal:"n"}],postprocess:function(e){return e.join("")}},{name:"ANNEE$ebnf$1",symbols:[/[0-9]/]},{name:"ANNEE$ebnf$1",symbols:["ANNEE$ebnf$1",/[0-9]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"ANNEE",symbols:["ANNEE$string$1","ANNEE$ebnf$1"],postprocess:function(e){return e[0]+e[1].join("")}},{name:"_$ebnf$1",symbols:[]},{name:"_$ebnf$1",symbols:["_$ebnf$1",/[\s]/],postprocess:function(e){return e[0].concat([e[1]])}},{name:"_",symbols:["_$ebnf$1"],postprocess:function(){return null}}],ParserStart:"main"};e.exports=n}()});function je(e,t,r){if("string"==typeof r)return function(e,t,n){switch(n){case"R":case"D":return e.CodRD===n;case"F":case"I":return t.ligneBudgetFI(e)===n;case"RF":case"RI":case"DF":case"DI":return e.CodRD===n[0]&&t.ligneBudgetFI(e)===n[1]}return n.startsWith("Ch")?t.ligneBudgetIsInChapitre(e,n.slice("Ch".length)):n.startsWith("C")?t.ligneBudgetIsInCompte(e,n.slice("C".length)):n.startsWith("F")?t.ligneBudgetIsInFonction(e,n.slice("F".length)):n.startsWith("Ann")?n.slice("Ann".length)===String(t.Exer):void console.warn("matchesSubset - Unhandled case",n)}(e,t,r);var o=n(r,3),s=o[0],i=o[1],a=o[2];if("("===s&&")"===a)return je(e,t,i);var l=i;switch(l){case"+":case"∪":return je(e,t,s)||je(e,t,a);case"∩":return je(e,t,s)&&je(e,t,a);case"-":return je(e,t,s)&&!je(e,t,a);default:console.warn("matchesSubset - Unhandled case",l,r)}console.warn("matchesSubset - Unhandled case",r)}var Pe=Object.freeze(function(){return!1}),_e=ge(function(e,t){var n=new Oe.Parser(Oe.Grammar.fromCompiled(Me));try{return n.feed(e),void 0===n.results[0]?Pe:ge(function(e){return je(e,t,n.results[0])})}catch(e){return Pe}});var Ue=Te("./data/plansDeCompte/plan-de-compte-M52-M52-2017.xml").then(function(e){var t=e.querySelector("Nomenclature"),n=new Map,r=new Map,o=!0,s=!1,i=void 0;try{for(var a,l=t.querySelectorAll("Compte")[Symbol.iterator]();!(o=(a=l.next()).done);o=!0){var u=a.value,c=u.getAttribute("Code");n.set(c,u.getAttribute("RR")),r.set(c,u.getAttribute("DR"))}}catch(e){s=!0,i=e}finally{try{o||null==l.return||l.return()}finally{if(s)throw i}}var f=new Map,p=!0,m=!1,h=void 0;try{for(var d,g=t.querySelectorAll("Chapitre")[Symbol.iterator]();!(p=(d=g.next()).done);p=!0){var y=d.value,b=y.getAttribute("Code");f.set(b,y.getAttribute("Section"))}}catch(e){m=!0,h=e}finally{try{p||null==g.return||g.return()}finally{if(m)throw h}}return{Norme:t.getAttribute("Norme"),Declinaison:t.getAttribute("Declinaison"),Exer:Number(t.getAttribute("Exer")),ligneBudgetFI:function(e){var t=e.CodRD,o=e.Nature,s=("R"===t?n:r).get(o);return f.get(s)},ligneBudgetChapitre:function(e){var t=e.CodRD,o=e.Nature;return("R"===t?n:r).get(o)},ligneBudgetIsInChapitre:function(e,t){var o=e.CodRD,s=e.Nature;return("R"===o?n:r).get(s)===t},ligneBudgetIsInCompte:function(e,n){var r=e.Nature,o=t.querySelector('Compte[Code="'.concat(r,'"]'));if(!o)return!1;for(var s=o;s;){if(s.getAttribute("Code")===n)return!0;if((s=s.parentNode).localName.toLowerCase()!=="Compte".toLowerCase())return!1}return!1},ligneBudgetIsInFonction:function(e,n){var r=e.Fonction,o=t.querySelector('RefFonctionnelles RefFonc[Code="'.concat(r,'"]'));if(!o)return!1;for(var s=o;s;){if(s.getAttribute("Code")===n)return!0;if((s=s.parentNode).localName.toLowerCase()!=="RefFonc".toLowerCase())return!1}return!1}}}),ke=Te("./data/CA/gironde/CA2017BPAL.xml").then(function(e){var n,o=e.getElementsByTagName("BlocBudget")[0],s=Number(o.getElementsByTagName("Exer")[0].getAttribute("V")),i=new Map,a=Array.from(e.getElementsByTagName("LigneBudget")).filter(function(e){var t="0"===e.getElementsByTagName("OpBudg")[0].getAttribute("V"),n=0!==Number(e.getElementsByTagName("MtReal")[0].getAttribute("V")),r=e.getElementsByTagName("Nature")[0].getAttribute("V"),o=e.getElementsByTagName("Fonction")[0].getAttribute("V");return t&&n&&!("001"===r&&"01"===o)&&!("002"===r&&"0202"===o)}).map(function(e){var t={};return["Nature","Fonction","CodRD","MtReal"].forEach(function(n){t[n]=e.getElementsByTagName(n)[0].getAttribute("V")}),t.MtReal=Number(t.MtReal),t}),l=!0,u=!1,c=void 0;try{for(var f,p=a[Symbol.iterator]();!(l=(f=p.next()).done);l=!0){var m=f.value,h=[(n=m).CodRD,n.Fonction,n.Nature].join(" "),d=i.get(h)||[];d.push(m),i.set(h,d)}}catch(e){u=!0,c=e}finally{try{l||null==p.return||p.return()}finally{if(u)throw c}}return{LibelleColl:e.getElementsByTagName("LibelleColl")[0].getAttribute("V"),Nomenclature:e.getElementsByTagName("Nomenclature")[0].getAttribute("V"),NatDec:o.getElementsByTagName("NatDec")[0].getAttribute("V"),Exer:s,IdColl:e.getElementsByTagName("IdColl")[0].getAttribute("V"),rows:new Set(r(i.values()).map(function(e){var n=V(e.map(function(e){return Number(e.MtReal)})),r=e[0];return Object.freeze(function(e){for(var n=1;n<arguments.length;n++){var r=null!=arguments[n]?arguments[n]:{},o=Object.keys(r);"function"==typeof Object.getOwnPropertySymbols&&(o=o.concat(Object.getOwnPropertySymbols(r).filter(function(e){return Object.getOwnPropertyDescriptor(r,e).enumerable}))),o.forEach(function(n){t(e,n,r[n])})}return e}({},r,{MtReal:n}))}))}}).catch(console.error),Le=ge(function(e,t,n){return r(t.rows).filter(_e(e,n))});ke.then(function(e){return console.log("docBudg",e)});var He={formula:decodeURIComponent(location.hash.slice(1))||"",planDeCompte:void 0,lignes:void 0,examples:[{formula:"D",description:"toutes les dépenses"},{formula:"R",description:"toutes les recettes"},{formula:"RI",description:"toutes les recettes d'investissement"},{formula:"DF",description:"toutes les dépenses de fonctionnement"},{formula:"DF∩F4",description:"toutes les dépenses de fonctionnement de la fonction 4"},{formula:"DF∩(F4 ∪ F5)",description:"toutes les dépenses de fonctionnement des fonctions 4 et 5"},{formula:"DF∩(C64111 ∪ C6451)",description:"toutes les dépenses de fonctionnement des natures 64111 et 6451 (salaire + URSSAF)"},{formula:"DF∩(C64111 ∪ C6451)∩F52",description:"toutes les dépenses de fonctionnement salaires+URSSAF lié à la fonction 52 (Personnes handicapées)"},{formula:"DF∩((F50∩(C64121 ∪ C64126)) ∪ (F51 - C6526))",description:"Gironde - social - enfance"},{formula:"RI∩Ch16",description:"toutes les recettes d'investissement du chapitre 16 (emprunts)"},{formula:"RF∩(C7478141 ∪ C7478142 ∪ C74788∩F53∩Ann2016)",description:"Gironde - recettes de fonctionnement - Conférence des financeurs"},{formula:"DF∩C60 - (F4∪F5∪F8∪F621)",description:"Gironde - dépense de fonctionnement - Achats et fournitures"}]};document.addEventListener("DOMContentLoaded",function(e){var t,r=new re({target:document.body.querySelector("main"),props:He});Promise.all([ke,Ue]).then(function(e){var o=n(e,2),s=o[0],i=o[1];He.planDeCompte=i;var a=function(e){He.formula=e,He.lignes=Le(e,s,i),r.$set(He)};r.$on("formula-change",function(e){var n=e.detail;a(n),clearTimeout(t),t=setTimeout(function(){location.hash=encodeURIComponent(n),t=void 0},3e3)}),window.addEventListener("hashchange",function(){var e=decodeURIComponent(location.hash.slice(1).trim());a(e)}),a(He.formula)})},{once:!0});
